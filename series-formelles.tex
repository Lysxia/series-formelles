%% -*- mode: LaTeX; compile-command: "mk" -*-
\documentclass{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Packages

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage[all]{xy}
\usepackage{prettyref}
\usepackage{mdframed}
\usepackage{todonotes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Theorem-like environments

\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{conj}[thm]{Conjecture}

\theoremstyle{definition}

\newtheorem{defn}[thm]{Definition}
\newtheorem{ex}{Example}

\theoremstyle{remark}
\newtheorem*{rem}{Remark}
\newtheorem*{nota}{Notation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Commentary environment

\newmdenv[leftmargin=1em, rightmargin=1em]{commentary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Math formatting

\newcommand{\B}{\mathbb{B}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\DeclareMathOperator{\el}{el}

\newcommand{\bij}{\stackrel{\sim}{\rightarrow}}
\newcommand{\inj}{\hookrightarrow}

\DeclareMathOperator{\Card}{Card}
\DeclareMathOperator{\Aut}{Aut}
\newcommand{\Mon}{\mathrm{Mon}}
\newcommand{\unl}[1]{\tilde{#1}}

\newcommand{\term}[1]{\emph{#1}}

\newcommand{\union}{\cup}
\newcommand{\intersect}{\cap}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Prettyref

\newrefformat{fig}{Figure~\ref{#1}}
\newrefformat{chap}{Chapter~\ref{#1}}
\newrefformat{sec}{\Sect\ref{#1}}
\newrefformat{eq}{equation~\eqref{#1}}
\newrefformat{prob}{Problem~\ref{#1}}
\newrefformat{tab}{Table~\ref{#1}}
\newrefformat{thm}{Theorem~\ref{#1}}
\newrefformat{lem}{Lemma~\ref{#1}}
\newrefformat{prop}{Proposition~\ref{#1}}
\newrefformat{defn}{Definition~\ref{#1}}
\newrefformat{cor}{Corollary~\ref{#1}}
\newrefformat{conj}{Conjecture~\ref{#1}}
\newrefformat{ex}{Example~\ref{#1}}

\newcommand{\pref}[1]{\prettyref{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\section{Introduction}
\label{sec:introduction}

\todo{Finish translating introduction}

\section{Species of Structures}
\label{sec:species-of-structures}

There already exists a precise concept of species of structures (\todo{Bourbaki
[2]}). Describing a particular species is often done by specifying the
conditions which a structure must satisfy to belong to the species.
This description may take the form of an axiomatic theory of the species
being considered. A key part of the concept is the transport of structures.

We will abstract the concept of species so that the transport of
structures is the main aspect. Moreover, as we only deal
with the problems of counting and finite enumeration, we will confine ourselves
to finitary species, unless otherwise noted.

\subsection{Species and cardinality}
\label{sec:species-and-cardinality}

\begin{defn}
  A (finitary) species is an endofunctor $M: \B \to \B$
  on the groupoid $\B$ of finite sets and bijections.
\end{defn}

\begin{commentary}
  Commentary explaining $\B$.  Can probably steal some stuff from my
  dissertation.
\end{commentary}

If $E$ is a finite set, $M [E]$ is the set of all \term{structures}
of the species $M$ on $E$. We say that $E$ is the \term{underlying} set of
$s \in M[E]$, or also that it is \term{supported} by $E$. We say
also, by an abuse of language, that $s$ is an \term{element} of $M$ ($s \in M$) and that it is an
\term{$M$-structure}.

If $u: E \to F$ is a bijection, the element $t = M [u] (s)$ is the structure on $F$
obtained by \term{transport along $u$}. The bijection $u$ is an \term{isomorphism}
between $s$ and $t$:
\[ u : s \to t. \]
We denote by $\el (M)$ the category whose objects are the $M$-structures and
whose morphisms are isomorphisms of $M$-structures; it is the
groupoid of \term{elements} of $M$. There is a \term{forgetful}
functor $U: \el (M) \to \B$ whose
value on $s \in M$ is the \term{underlying} set of the structure $s$. The concept
of isomorphism of structures defines an equivalence relation whose
classes are the \term{types} of structures of the species M; these classes are
the \term{connected components} of the groupoid $\el (M)$. We use the notation
$\pi_0 (M)$ to denote the set of types (of structures) of the species $M$. If
$s \in M$, we denote the \term{type} of $s$ by the notation $|s| \in \pi_0 (M)$.

\newcommand{\Simp}{\mathcal{S}}

\begin{ex}
  Recall that a \emph{simplicial scheme} structure on $E$ is a set
  $\Simp$ of non-empty subsets of $E$ such that (i) every non-empty
  subset contained in an element of $\Simp$ belongs to $\Simp$, (ii)
  the singletons $\{x\}$ for $x \in E$ belong to $\Simp$. The elements
  of $\Simp$ are \emph{simplices}. The dimension of a simplex is one
  less than its cardinality. A \emph{graph} is a simplicial scheme
  whose simplices have dimension $\leq 1$. If $u : E \to F$ is a
  bijection, it is clear that $u (\Simp) = \{u(S) \mid S \in \Simp\}$
  is also a simplicial scheme structure on $F$. We can therefore
  consider the \emph{species} of simplicial schemes. It is also clear
  that if $\Simp$ is a graph then $u(\Simp)$ is one too; we obtain the
  species of graphs, which is a \emph{subspecies} of the species of
  simplicial schemes. More generally, any property $P$ which applies
  to simplicial schemes, and whose satisfaction \todo{wording?} is
  invariant under isomorphism, determines a subspecies of the species
  of simplicial schemes. For example, connectedness is such an
  invariant property. The species of \emph{forests} is that of graphs
  \emph{without cycles}, the species of \emph{trees} is that of
  connected forests, etc.
\end{ex}

\begin{ex} \label{ex:endofunctions}
  The transport of an endofunction $a : E \to E$ along a bijection $u
  : E \bij F$ is by \emph{conjugation}: $\phi \mapsto u \phi
  u^{-1}$. The species of \emph{permutations} is a subspecies of the
  species of endofunctions. If we require that the graph of an
  endofunction is connected, we obtain the subspecies of
  \emph{connected endofunctions} and, likewise, that of \emph{circular
    permutations}. An important concept is that of \emph{contraction}:
  an endofunction $\phi : E \to E$ is a contraction if there exists
  $x_0 \in E$ such that for every $x \in E$ we have $\phi^n(x) = x_0$
  when $n$ is large enough. That is, a contraction is an endofunction
  which is ultimately constant.
\end{ex}

\begin{ex}
  Let $S$ be the species of permutations. Consider the groupoid $\el
  (S)$ of elements of $S$. The objects of $\el (S)$ are the sets $E
  \in \B$ equipped with a permutation $\sigma_E \in S [E]$. The
  morphisms $(E, \sigma_E) \to (F, \sigma_F)$ are the bijections $u: E
  \to F$ such that $u\sigma_E = \sigma_F u$. Let $x_1, x_2, x_3,
  \dots$ be an infinite sequence of variables.  Let $I (\sigma_E) =
  x_1^{d_1} \dots x_n^{d_n}$, where $n = \Card E$ and where $d_i$ is
  the number of cycles of length $i$ in $\sigma_E$. Two objects $(E,
  \sigma_E)$ and $(F, \sigma_E)$ in $\el (S)$ are isomorphic if and
  only if $I (\sigma_E) = I (\sigma_F)$. The set $\pi_0(S)$ of
  connected components of the groupoid $\el (S)$ is therefore
  naturally identified with the set $\Mon(x)$ of all monomials in the
  variables $x_1, x_2, x_3, \dots$
\end{ex}

\subsubsection{}
The group $E!$ of permutations of $E$ acts on $M [E]$ by transport
of structures. The set $\pi_0 (M [E])$ of \emph{orbits} is identified
with the set of types of $M$-structures supported by sets equipotent
with $E$. We identify the orbit of $s \in M[E]$ with its type
$|s|$. The \emph{stabilizer} subgroup of an element $s \in M [E]$ is
the group $\Aut (s)$ of \emph{automorphisms} of $s$. We have the
well-known formula \[ \Card |s| = \frac{n!}{\Card \Aut(s)}. \]

One of the fundamental problems of enumerative combinatorics is to
evaluate the two infinite sequences of numbers
\begin{gather}
  \Card M[n], \quad \text{$n \geq 0$ ($[n] = \{1, 2, \dots, n\}$)}, \\
  \Card \pi_0(M[n]), \quad n \geq 0.
\end{gather}

We define two generating functions. The first is a series of Hurwitz
(Comtet [6] \todo{citation}):

\begin{equation}
  M(x) = \sum_{n \geq 0} \Card M[n] \frac{x^n}{n!}.
\end{equation}

The second is a power series with integer coefficients (without
factorial):

\begin{equation}
  \unl M(x) = \sum_{n \geq 0} \Card \pi_0(M[n]) x^n.
\end{equation}

We say that $M (x)$ is the \emph{cardinality} of $M$. Let us see
immediately that the calculation of $\unl M (x)$ boils down to
computing the cardinality of the \emph{associated} species $\unl M$.

\begin{defn}
  A structure of the species $\unl M$ is a pair $(\sigma, s)$ where
  $\sigma$ is an automorphism of $s \in M$.
\end{defn}

\begin{prop}
  We have
  \[ \unl M (x) = \Card {\unl M}. \]
\end{prop}

\begin{proof}
  We use Burnside's lemma: if a finite group $G$ acts on a finite set
  $X$, then the cardinality of the set $\pi_0(X)$ of orbits of $X$ is
  equal to that of the set $\{(\sigma, x) \mid \sigma \in G, x \in X,
  \sigma \cdot x = x\}$ \emph{divided by} $\Card G$. (See Burnside
  [3]. \todo{Citation})
\end{proof}

\subsection{The category of species}

Species form a category: they are functors, and one can take natural
transformations as morphisms. As it is desirable to have a larger than
class of morphisms than that of isomorphisms, it is best to consider a
species as a functor $M: \B \to \E$ to the category $\E$ of finite sets
and \emph{functions} (by composing with the inclusion $\B \inj \E$).

\begin{defn}
  A \emph{morphism} $\alpha : M \to N$ is a natural transformation
  from $M$ to $N$, considered as functors from $\B$ to $\E$.
\end{defn}

One can interpret $\alpha$ as follows: one has a \emph{construction}
$\alpha$ allowing one to produce a structure of the species $N$
(output) from a structure of the species $M$ (input), and for every
bijection $u : E \to F$ the rectangle \[ \xymatrix{M[E]
  \ar[r]^{\alpha_E} \ar[d]_{M[u]} & N[E] \ar[d]^{N[u]} \\ M[F]
  \ar[r]^{\alpha_F} & N[F] } \] commutes; this means that the
construction is \emph{equivariant} (or invariant): it does not change
if one \emph{simultaneously} transports the input and the output along
the same bijection; the vast majority of mathematical constructions
have this property.

If $\sigma_E$ is invertible regardless of $E$, the morphism $\alpha$
is an \emph{isomorphism} between $M$ and $N$. In this case, we write
$M \stackrel{\alpha}{=} N$, or more simply (by an abuse of notation) $M
= N$. If $M$ and $N$ satisfy the weaker condition $\Card M = \Card N$,
we say that $M$ and $N$ are \emph{equipotent} species, and we write $M
\equiv N$.

\begin{ex}
  The construction of the transitive closure of a graph determines a
  morphism from the species of graphs to the species of partitions.
\end{ex}

\begin{ex}
  A \emph{rooted tree} is a tree equipped with a \emph{root} (which is
  an arbitrary vertex of the underlying set). We usually orient the
  edges of a rooted tree in the direction of the root. If we adjoin a
  loop to the root, we obtain the graph of a \emph{contraction}
  (\pref{ex:endofunctions}). There is an \emph{isomorphism} between
  the species of rooted trees and the species of contractions.
\end{ex}

\begin{ex}
  The species of linear orders, of permutations, of permutations
  equipped with a fixed point, and of circular permutations equipped
  with an automorphism are all \emph{equipotent}, without being
  isomorphic.
\end{ex}

\subsubsection{} A morphism of species $M \to N$ determines a functor
$\el (M) \to \el (N)$ between the corresponding groupoids. Note that
this functor commutes with the forgetful functors \[ \xymatrix{\el(M)
  \ar[rr] \ar[dr]_U & & \el(N) \ar[dl]^U \\ & B} \] \todo{Make this
  not as wide}

It is not true that a functor $\el (M) \to \el (N)$ is always induced
by a morphism of species $M \to N$. For example, if $M$ is the species
of preorders and $N$ the species of the orders, the usual construction
of an order relation to from a pre-order (on a quotient of the
pre-order's underlying set) determines a functor $\el (M) \to \el (N)$
that \emph{does not come} from a morphism of species $M \to
N$. However, it is easily checked that every functor $\el (M) \to \el
(N)$ which commutes with the forgetful functors $U$ is induced by one
and only one species morphism $M \to N$.

\subsection{Relative species}

We want to examine the concept of a \emph{relative} species. We begin
with an example. Let $G$ be the species of \emph{graphs}. The concept
of \emph{orientation} gives us a functor $O : \el (G) \to \E$, because
one can transport a graph orientation along a graph isomorphism. The
species of \emph{orientations} (of a graph) is \emph{relative} to that
of graphs. On the other hand, the species $GO$ of \emph{oriented
  graphs} is equipped with a projection $GO \to G$.

\begin{defn}
  Let $M$ be a species. A species \emph{relative} to $M$ is a functor
  $T_M : \el (M) \to \E$.
\end{defn}

\todo{Ugh, this paragraph will need a lot of commentary and/or some
  nice pictures.}
Given $T_M$, one can construct a species $T$
equipped with a morphism $T \to^p M$: set $T [E] = \{(s, \alpha) \mid
s \in M [E], \alpha \in T_M[s]\}$. To transport $(s, \alpha) \in T[E]$
along a bijection $u : E \to F$ we begin by transporting $s$ to obtain
$t = M [u] (s)$, which gives first an isomorphism $s \to^u t \in
\el(M)$ and then $\beta = T_M [u] (\alpha)$; we set $T [u] (s, \alpha)
= (t, \beta)$. The morphism $p : T \to M$ is the projection $p (s,
\alpha) = s$. Conversely, given a morphism $T \to^p M$, we can
construct $T_M$: if $s \in M [E]$, we have $p_E: T [E] \to M [E]$ and
set $T_M [s] = p_E^{-1}\{s\} \subseteq T [E]$. Naturality of $p$
allows us to verify that if $u : E \to F$ is an isomorphism between $s
\in M [E]$ and $T \in M [F]$ then $T [u]$ turns $p_E^{-1} \{s\}$ into
$p_E^{-1} \{t\}$, which gives $T_M [u] : T_M [s] \to T_M [t]$. We
have, in fact, a precise proposition: a \term{species over $M$} is a
species $T$ equipped with a morphism $T \to^p M$. A morphism $(T, p)
\to (T', p')$ between species above $M$ is an arrow $T \to^u T'$ such
that $p'\ u = p$.

\begin{prop}
The constructions described above define a
equivalence between the category of species relative to $M$ and the category
$E \|X\|/_M$ of species over $M$.See REFERENCE 2.0 for the notation
$E\|X\|$.)
\end{prop}

Suppose $T_M: \el (M) \to E$ is given. We often say that $(s, \alpha)
\in T [E]$ is an $M$-structure $s$ \term{equipped} with an element
$\alpha \in T_M[s]$. For example, a directed graph is a graph
\term{equipped} with an orientation. A structure of the species
$\tilde M$ (DEFINITION 2) is an $M$-structure \term{equipped} with an
automorphism.  \emph{etc.}

We sometimes use the term ``enriched'' rather than ``equipped''. Thus,
if $R$ is any species, we will say that endofunction $\phi : E \to E$
is \term{$R$-enriched} if each of its \term{fibers} $\phi^{-1}\{x\}$,
$x \in E$ is equipped with an $R$-structure.  Similarly, let $a$ be an
arborescence \todo{???} on $E$. The \term{fiber} $a^{-1}\{x\}$ of a
vertex $x \in E$ is the set of vertices of $a$ connected to $x$ by an
edge adjacent to $x$ (for the orientation of a tree as described in
Example XXX \todo{fill in}). We say that $a$ is \term{$R$-enriched} if each of its
fibers is equipped with an $R$-structure. (Keeping in mind the empty
fibers.)

In graphical representations of endofunctions or $R$-enriched trees it
is often convenient to assume that $R$-structures on the fibers are
placed on the set of \emph{edges} of the fibers.  For example, an
$R$-enriched tree can be represented as in Figure XXX \todo{make a
  figure} where an arc cutting through the edges of a fiber denotes an
$R$-structure. Don't forget the leaves.

\section{The Combinational Operations}
\label{sec:combinatorial-operations}

\newcommand{\Poly}[2]{#1 \llbracket #2 \rrbracket}

The category of species is rich in various operations. In this
section, we describe several operations of which three are binary.
The first two are the sum (disjoint) and the product. With these two
operations, the category of species becomes a kind of semi-ring.  More
precisely, let $R$ be a commutative ring, and denote by $\Poly R x$
the ring of Hurwitz series with coefficients in $R$: these are the
formal series
\[ \sum_{n \geq 0} a_n \frac{x^n}{n!}, \quad \text{where $n \geq 0,
  a_n \in R$.} \] The continued analogy here is that the category of
species would be the semiring $\Poly{\E}{X}$ of Hurwitz series, but
\emph{with coefficients from the category $\E$ of finite sets}. The
concept of cardinality induces a \emph{homomorphism}
\[ \Card : \Poly{\E}{X} \to \Poly{\Z}{x}. \]

In addition, the evaluation $M \mapsto M [0]$ is a functor preserving sum and
product

\[ \Poly \E X \to \E \]

whose kernel $J$ is an ideal on which we will describe the operations
of \term{divided powers} (Cartan [4] XXX look this up)

\[ \gamma_n : J \to \Poly \E X \quad \text{($n \geq 0$)} \]



so that we have


\[ \Card \gamma_n(M) = \frac{M(x)^n}{n!} \quad \text{($n \geq 0$)}. \]



Using these operations of divided powers we then describe
the operation of \term{substitution} of one species into another. We end this
chapter with an introduction to the \term{differential calculus} of species
and a \emph{combinatorial} proof of the Lagrange inversion formula.

\subsection{Sum and product}

The disjoint sum of two species $M$ and $N$ is the \emph{coproduct}
in the category of species:
\[ (M + N) [E] = M [E] + N [E]. \]

More generally, an arbitrary family of species $(M_i)_{i \in I}$ is
summable if for any finite set $E$, the set of indices $i \in I$ for
which $M_i[E] \neq \varnothing$ is finite.  We set
\[ \left( \sum_{i \in I} M_i \right) [ E ] = \sum_{i \in I} M_i[E]. \]
It is clear that $\Card$ preserves sum. We now turn to the definition
of the \term{product} $M \cdot N$ of two species $M$ and $N$. Define
first a \term{partition} of a set $E$ into two \term{parts} is a pair
$(E_1, E_2)$ such that $E_1 \union E_2 = E$ and $E_1 \intersect E_2 =
\varnothing$. One defines in the same way the concept of a partition
of $E$ into $n$ pieces ($n \in \N$): we write $E = E_ + \dots + E_n$
to indicate that $(E_1, \dots, E_n)$ is a partition of $D$ into $n$
pieces.

\begin{defn}
  A structure of the species $M \cdot N$ on $E \in \B$ is a quadruplet
  $(E_1, E_2, s, t)$, where $E = E_1 + E_2$ and $(s, t) \in M[E_1]
  \times N [E_2]$.
\end{defn}

\begin{prop}
We have
\[ \Card (M \cdot N) = \Card (M) \cdot \Card (N). \]
\end{prop}
\begin{proof}
By definition,
\[ (M \cdot N)[E] = \sum_{E_1 + E_2 = E} M[E_1] \times N[E_2]. \]
If $\Card E = n$ and $0 \leq k \leq n$ there are $\binom n k$
partitions $E = E_1 + E_2$ with $\Card E_1 = k$.  As a result,
\[ \Card(M \cdot N) [n] = \sum_{k=0}^n \binom n k \Card M [k] \Card N
[n - k]. \]
\end{proof}

\end{document}
